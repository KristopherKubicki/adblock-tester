<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Browser Fingerprint</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap");
      :root {
        font-family: "Inter", system-ui, sans-serif;
        font-size: 16px;
        --bg-dark: #111;
        --bg-light: #1e1e1e;
      }
      body {
        margin: 0;
        padding: 1rem;
        background: var(--bg-dark);
        color: #eee;
        display: flex;
        flex-direction: column;
        height: 100vh;
        overflow: hidden;
        gap: 1rem;
      }
      nav {
        display: flex;
        justify-content: center;
        gap: 1rem;
      }
      nav a {
        color: #eee;
        text-decoration: none;
        font-size: 0.9rem;
      }
      nav a:hover {
        text-decoration: underline;
      }
      h1 {
        margin: 0 0 0.5rem;
        text-align: center;
        font-size: clamp(1.5rem, 5vw, 2rem);
      }
      #fp {
        flex: 1 1 auto;
        overflow: hidden;
      }
      dl {
        margin: 0;
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 0.25rem 1rem;
      }
      dt {
        font-weight: 600;
      }
      dd {
        margin: 0 0 0.5rem 0;
        word-break: break-all;
      }
      @media (min-width: 600px) {
        dl {
          grid-template-columns: auto 1fr auto 1fr;
        }
      }
      @media (min-width: 900px) {
        dl {
          grid-template-columns: auto 1fr auto 1fr auto 1fr;
        }
      }
      @media (max-height: 600px) {
        body {
          font-size: 0.85rem;
        }
      }
      @media (prefers-color-scheme: light) {
        :root {
          --bg-dark: #fafafa;
          --bg-light: #fff;
        }
        body {
          color: #111;
        }
      }
    </style>
  </head>
  <body>
    <nav>
      <a href="index.html">Ad Test</a>
      <a href="bots.html">Bots</a>
      <a href="fingerprint.html">Fingerprint</a>
    </nav>
    <h1>Browser Fingerprint</h1>
    <div id="fp"></div>
    <script>
      function hash(str) {
        let out = 0;
        for (let i = 0; i < str.length; i++) {
          out = (out << 5) - out + str.charCodeAt(i);
          out |= 0;
        }
        return out.toString();
      }

      function getCanvasHash() {
        try {
          const c = document.createElement("canvas");
          c.width = 200;
          c.height = 50;
          const ctx = c.getContext("2d");
          ctx.textBaseline = "top";
          ctx.font = "14px Arial";
          ctx.fillStyle = "#f60";
          ctx.fillRect(0, 0, 100, 30);
          ctx.fillStyle = "#069";
          ctx.fillText("fingerprint", 2, 15);
          return hash(c.toDataURL());
        } catch {
          return "n/a";
        }
      }

      function getWebGLInfo() {
        try {
          const c = document.createElement("canvas");
          const gl =
            c.getContext("webgl") || c.getContext("experimental-webgl");
          if (!gl) return { vendor: "n/a", renderer: "n/a" };
          const dbg = gl.getExtension("WEBGL_debug_renderer_info");
          const vendor = dbg
            ? gl.getParameter(dbg.UNMASKED_VENDOR_WEBGL)
            : gl.getParameter(gl.VENDOR);
          const renderer = dbg
            ? gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL)
            : gl.getParameter(gl.RENDERER);
          return { vendor, renderer };
        } catch {
          return { vendor: "n/a", renderer: "n/a" };
        }
      }

      function detectFonts() {
        const baseFonts = ["monospace", "sans-serif", "serif"];
        const testFonts = [
          "Arial",
          "Courier New",
          "Times New Roman",
          "Comic Sans MS",
        ];
        const span = document.createElement("span");
        span.textContent = "abcdefghi";
        span.style.fontSize = "72px";
        span.style.position = "absolute";
        span.style.visibility = "hidden";
        document.body.appendChild(span);
        const defW = {};
        const defH = {};
        for (const f of baseFonts) {
          span.style.fontFamily = f;
          defW[f] = span.offsetWidth;
          defH[f] = span.offsetHeight;
        }
        const detected = [];
        for (const font of testFonts) {
          for (const base of baseFonts) {
            span.style.fontFamily = `'${font}',${base}`;
            if (
              span.offsetWidth !== defW[base] ||
              span.offsetHeight !== defH[base]
            ) {
              detected.push(font);
              break;
            }
          }
        }
        document.body.removeChild(span);
        return detected.join(", ");
      }

      function getPublicIP() {
        return fetch("https://api.ipify.org?format=json")
          .then((r) => r.json())
          .then((d) => d.ip)
          .catch(() => "n/a");
      }

      function getLocalIPs() {
        return new Promise((resolve) => {
          const pc = new RTCPeerConnection({ iceServers: [] });
          const ips = new Set();
          pc.createDataChannel("");
          pc.onicecandidate = (e) => {
            if (!e.candidate) {
              pc.close();
              resolve(Array.from(ips).join(", ") || "n/a");
              return;
            }
            const m = /([0-9]{1,3}(?:\.[0-9]{1,3}){3})/.exec(e.candidate.candidate);
            if (m) ips.add(m[1]);
          };
          pc.createOffer().then((o) => pc.setLocalDescription(o));
        });
      }

      function getGeo() {
        return new Promise((resolve) => {
          if (!navigator.geolocation) return resolve("n/a");
          navigator.geolocation.getCurrentPosition(
            (pos) => {
              const { latitude, longitude } = pos.coords;
              resolve(`${latitude.toFixed(4)}, ${longitude.toFixed(4)}`);
            },
            () => resolve("n/a"),
            { timeout: 3000 }
          );
        });
      }

      async function render() {
        const { vendor: webglVendor, renderer: webglRenderer } = getWebGLInfo();
        const data = {
          "IP Address": await getPublicIP(),
          "Local IPs": await getLocalIPs(),
          "User Agent": navigator.userAgent,
          Languages: navigator.languages ? navigator.languages.join(", ") : "",
          Platform: navigator.platform,
          "Hardware Concurrency": navigator.hardwareConcurrency,
          "Device Memory": navigator.deviceMemory,
          Screen: `${screen.width} x ${screen.height}`,
          "Color Depth": screen.colorDepth,
          "Timezone Offset": new Date().getTimezoneOffset(),
          "Do Not Track": navigator.doNotTrack || window.doNotTrack || "",
          "Cookies Enabled": navigator.cookieEnabled,
          "Local Storage": !!window.localStorage,
          "Session Storage": !!window.sessionStorage,
          "Touch Points": navigator.maxTouchPoints,
          Plugins: Array.from(navigator.plugins || [])
            .map((p) => p.name)
            .join(", "),
          "Canvas Hash": getCanvasHash(),
          "WebGL Vendor": webglVendor,
          "WebGL Renderer": webglRenderer,
          Fonts: detectFonts(),
          Geolocation: await getGeo(),
        };
        const container = document.getElementById("fp");
        const dl = document.createElement("dl");
        for (const [k, v] of Object.entries(data)) {
          const dt = document.createElement("dt");
          dt.textContent = k;
          const dd = document.createElement("dd");
          dd.textContent = String(v);
          dl.appendChild(dt);
          dl.appendChild(dd);
        }
        container.appendChild(dl);
      }

      render();
    </script>
  </body>
</html>
